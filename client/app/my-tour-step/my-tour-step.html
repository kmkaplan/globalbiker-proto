<div ng-include="'components/navbar/navbar.html'"></div>
<div class="container my-tour-step-page">
    <ol class="breadcrumb">
        <li><a href="/my-tours" translate="mytours.nav-bar_name">My tours</a>
        </li>
        <li><a href="/my-tour/{{ step.tour._id }}">{{ step.tour.title }}</a>
        </li>
        <li class="active">{{ 'mytours.steps.from' | translate }} {{ step.cityFrom.name }} {{ 'mytours.steps.to' | translate }} {{ step.cityTo.name }}</li>
    </ol>
    <h2>{{ "mytours.steps.from" | translate }} {{ step.cityFrom.name }} {{ "mytours.steps.to" | translate }} {{ step.cityTo.name }}</h2>
    <div class="row">
        <div class="col-md-7">
            <div extended-map config="mapConfig"></div>
        </div>

        <div class="col-md-5">

            <div class="form-group">
                <label>Description</label>
                <textarea ui-tinymce=" { menubar : false, toolbar: 'bold italic bullist numlist outdent indent removeformat subscript superscript' }" name="description" ng-change="saveDescription()" ng-model="step.originalModel.description" type="text" class="form-control"></textarea>
            </div>
           
            <div class="modal fade" role="dialog" arial-hidden="true" id="new-point-of-interest-form">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                            </button>
                            <h4 class="modal-title" translate="mytourstep.new">New point of interest</h4>
                        </div>
                        <div class="modal-body">
                            <form novalidate role="form" name="createPointForm" ng-submit="submitCreatePointForm(createPointForm)">
                                <section class="form-section">
                                    <div class="form-group required" ng-class="{ 'has-error':  createPointForm.type.$invalid, 'has-success':createPointForm.type.$valid }">
                                        <label class="control-label">Type</label>
                                        <select required name="type" ng-model="newMarker.type" class="form-control">
                                            <option value="interest" translate="mytourstep.interest">interest</option>
                                            <option value="bike-shops" translate="mytourstep.bike-shop">bike-shop</option>
                                            <option value="food" translate="mytourstep.food">food</option>
                                            <option value="danger" translate="mytourstep.danger">danger</option>
                                        </select>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group required" ng-class="{ 'has-error':  createPointForm.name.$dirty && createPointForm.name.$invalid, 'has-success': createPointForm.name.$dirty && createPointForm.name.$valid }">
                                                <label class="control-label" translate="mytourstep.name">Name</label>
                                                <input required name="name" ng-model="newMarker.name" type="text" class="form-control" placeholder="Enter the name of this point ...">
                                                <label class="error-label" ng-show="createPointForm.name.$invalid && createPointForm.name.$dirty" translate="mytourstep.name_warn">The name is required.</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label">Importance</label>
                                                <select name="priority" ng-model="newMarker.priority" class="form-control">
                                                    <option value=""></option>
                                                    <option value="1">en page d'accueil</option>
                                                </select>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="form-group required" ng-class="{ 'has-error':  createPointForm.description.$dirty && createPointForm.description.$invalid, 'has-success': createPointForm.description.$dirty && createPointForm.description.$valid }">
                                        <label accesskey="" class="control-label" translate="mytourstep.description">Description</label>
                                        <input required name="description" ng-model="newMarker.description" type="text" class="form-control" placeholder="Enter the description of this point ...">
                                        <label class="error-label" ng-show="createPointForm.description.$invalid && createPointForm.description.$dirty" translate="mytourstep.description_warn">The description is required.</label>
                                    </div>

                                    <div class="form-group">
                                        <a ng-disabled="createPointForm.$invalid" class="btn btn-primary" ng-click="submitCreatePointForm(createPointForm)"><i class="icon fa fa-plus-square"></i> {{ "mytourstep.add_to_map" | translate }}</a>
                                    </div>
                                </section>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <form role="form">
                <section class="form-section">
                    <div ng-show="steppoints.length && !step.isTraceInEdition">
                        <a ng-click="step.isTraceInEdition = true" class="btn btn-default edit-step-trace-button pull-right"><i class="fa fa-pencil-square-o"></i></a>
                    </div>
                    <div ng-show="step.isTraceInEdition">
                        <a ng-click="step.isTraceInEdition = false" class="btn btn-success leave-edit-step-trace-button pull-right"><i class="fa fa-check"></i></a>
                    </div>
                    <h3 translate="mytourstep.your_itinary_trace">Your itinary trace</h3>
                    <div class="trace-resume-area" ng-show="steppoints.length">
                        <h4 translate="mytourstep.trace_resume">Trace resume</h4>

                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <th translate="mytourstep.total_distance">Total distance</th>
                                    <td>{{ step.readableDistance }}</td>
                                </tr>
                                <tr ng-show="step.readablePositiveElevationGain">
                                    <th translate="mytourstep.positive_elevation_gain">Positive elevation gain</th>
                                    <td>{{ step.readablePositiveElevationGain }}</td>
                                </tr>
                                <tr ng-show="step.readableNegativeElevationGain">
                                    <th translate="mytourstep.negative_elevation_gain">Negative elevation gain</th>
                                    <td>{{ step.readableNegativeElevationGain }}</td>
                                </tr>
                                <tr>
                                    <th translate="mytourstep.points_number">Number of points</th>
                                    <td>{{ steppoints.length }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-hide="steppoints.length && !step.isTraceInEdition">
                        <h4 translate="mytourstep.update_your_trace">Update your trace</h4>
                        <div class="form-group">
                            <div class="file-upload btn btn-primary">
                                <span translate="mytourstep.select_gps_file">SÃ©lectionner un fichier de trace GPS (*.kml file):</span>
                                <input type="file" class="upload" ng-file-select="onFileSelect($files)" />
                            </div>
                        </div>
                        <div class="form-group" translate="mytourstep.draw_it_manually">
                            Or draw it manually using the tools in the map!
                        </div>
                        <div class="form-group" ng-show="step.isTraceInEdition">
                            <h4 translate="mytourstep.delete_your_trace">Delete your trace</h4>
                            <div>
                                <a title="Delete current trace" ng-click="deleteTrace()" class="btn btn-danger delete-step-button"><i class="fa fa-trash-o"></i> {{ "mytourstep.delete_current_trace" | translate }}</a>
                            </div>
                        </div>
                    </div>

                </section>
            </form>

            <section class="form-section selected-point-of-interest" ng-show="selectedPointOfInterest">
                <form novalidate role="form" name="editPointForm" ng-submit="submitEditPointForm(editPointForm)">
                    <div ng-hide="editSelectedPointOfInterest">
                        <a ng-click="editSelectedPointOfInterest = true" class="btn btn-default pull-right"><i class="fa fa-pencil-square-o"></i></a>
                    </div>
                    <div ng-show="editSelectedPointOfInterest">
                        <a ng-click="submitEditPointForm(editPointForm)" class="btn btn-success pull-right"><i class="fa fa-check"></i></a>
                    </div>
                    <h4 ng-switch="selectedPointOfInterest.type">
                            <span class="interest-type interest" ng-switch-when="interest">
                                <i class="icon glyphicon glyphicon-eye-open"></i> Interest
                            </span>
                            <span class="interest-type bike-shops" ng-switch-when="bike-shops">
                                <i class="icon glyphicon glyphicon-wrench"></i> Bike shop
                            </span>
                            <span class="interest-type food" ng-switch-when="food">
                                <i class="icon glyphicon glyphicon-cutlery"></i> Food
                            </span>
                            <span class="interest-type danger" ng-switch-when="danger">
                                <i class="icon fa fa-exclamation-triangle"></i> Danger
                            </span>
                            <span class="interest-type" ng-switch-default>                               
                                <i class="icon glyphicon glyphicon-question-sign"></i> Other
                            </span>
                            <span ng-show="selectedPointOfInterest.name">"{{ selectedPointOfInterest.name }}"</span>
                            <span ng-if="selectedPointOfInterest.priority == 1">(page d'accueil)</span>
                        </h4>
                    <div ng-hide="editSelectedPointOfInterest" class="photos-area">
                        <p ng-if="selectedPointOfInterest.description">{{ selectedPointOfInterest.description }}</p>
                        <h4>Add a photo</h4>
                        <div class="form-group">
                            <div class="file-upload btn btn-primary">
                                <span>Upload a photo (*.img, *.jpg, *.png file):</span>
                                <input type="file" class="upload" ng-file-select="onPhotoSelect($files)" />
                            </div>
                            <div ng-if="photoUploadProgress !== null">
                                <i class="fa fa-spinner fa-spin"></i> Envoi en cours...
                                <progressbar max="100" value="photoUploadProgress"></progressbar>
                            </div>
                        </div>

                        <div class="row" ng-if="selectedPointOfInterest.photos.length">
                            <div class="col-md-6" ng-repeat="photo in selectedPointOfInterest.photos">
                                <a ng-click="removePhoto(selectedPointOfInterest, photo)" class="btn btn-sm btn-default remove-button"><i class="fa fa-times"></i></a>
                                <img class="smart-photo" alt="-" ng-src="{{ photo.url }}" />
                            </div>
                        </div>

                    </div>
                    <div ng-show="editSelectedPointOfInterest">
                        <div class="form-group required" ng-class="{ 'has-error':  editPointForm.type.$invalid, 'has-success':editPointForm.type.$valid }">
                            <label class="control-label">Type</label>
                            <select required name="type" ng-model="selectedPointOfInterest.type" class="form-control">
                                <option value="interest" translate="mytourstep.interest">interest</option>
                                <option value="bike-shops" translate="mytourstep.bike-shop">bike-shop</option>
                                <option value="food" translate="mytourstep.food">food</option>
                                <option value="danger" translate="mytourstep.danger">danger</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group required" ng-class="{ 'has-error':  editPointForm.name.$dirty && editPointForm.name.$invalid, 'has-success': editPointForm.name.$dirty && editPointForm.name.$valid }">
                                    <label class="control-label" translate="mytourstep.name">Name</label>
                                    <input required name="name" ng-model="selectedPointOfInterest.name" type="text" class="form-control" placeholder="Enter the name of this point ...">
                                    <label class="error-label" ng-show="editPointForm.name.$invalid && editPointForm.name.$dirty" translate="mytourstep.name_warn">The name is required.</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label">Importance</label>
                                    <select name="priority" ng-model="selectedPointOfInterest.priority" class="form-control">
                                        <option value=""></option>
                                        <option value="1">en page d'accueil</option>
                                    </select>
                                </div>
                            </div>

                        </div>

                        <div class="form-group required" ng-class="{ 'has-error':  editPointForm.description.$dirty && editPointForm.description.$invalid, 'has-success': editPointForm.description.$dirty && editPointForm.description.$valid }">
                            <label accesskey="" class="control-label" translate="mytourstep.description">Description</label>
                            <input required name="description" ng-model="selectedPointOfInterest.description" type="text" class="form-control" placeholder="Enter the description of this point ...">
                            <label class="error-label" ng-show="editPointForm.description.$invalid && editPointForm.description.$dirty" translate="mytourstep.description_warn">The description is required.</label>
                        </div>
                    </div>
                </form>
            </section>

        </div>
    </div>
</div>
